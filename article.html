<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Net Thud — AI News</title>
  <meta name="description" content="Net Thud AI news detail view." />

  <style>
    :root{
      --bg0:#07090b; --bg1:#0a0f12;
      --text:#e9eef2; --muted:#aab6c3; --muted2:#7f8c99;
      --accent:#78ff6a; --accent2:#39d9ff;
      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --shadow2: 0 10px 40px rgba(0,0,0,.45);
      --r20: 20px;
      --container: 980px;
      --ease: cubic-bezier(.2,.9,.2,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 12% 18%, rgba(120,255,106,.12), transparent 55%),
        radial-gradient(900px 600px at 78% 22%, rgba(57,217,255,.10), transparent 52%),
        radial-gradient(1000px 700px at 60% 82%, rgba(120,255,106,.08), transparent 52%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      letter-spacing:-0.01em;
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:var(--container); margin:0 auto; padding:0 18px}
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(7,9,11,.72), rgba(7,9,11,.38));
      border-bottom:1px solid rgba(36,48,58,.55);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      height:74px; gap:10px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:38px; height:38px; border-radius:12px;
      background:
        radial-gradient(12px 12px at 25% 25%, rgba(120,255,106,.95), transparent 60%),
        radial-gradient(18px 18px at 70% 35%, rgba(57,217,255,.85), transparent 62%),
        radial-gradient(22px 22px at 55% 75%, rgba(120,255,106,.55), transparent 65%),
        linear-gradient(145deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    .brandTitle{line-height:1.1}
    .brandTitle b{
      display:block;
      font-size:13px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .brandTitle small{display:block; margin-top:3px; color:var(--muted2); font-weight:700}
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      font-weight:900;
      font-size:12px;
      transition: transform .15s var(--ease), border-color .15s var(--ease), background .15s var(--ease);
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.16); background: rgba(255,255,255,.045);}
    main{padding:18px 0 48px}
    .panel{
      border-radius: var(--r20);
      border:1px solid rgba(255,255,255,.08);
      background: rgba(10,15,18,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .panelHead .k{color:var(--muted); font-weight:900; font-size:12px; letter-spacing:.14em; text-transform:uppercase}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(57,217,255,.25);
      color: rgba(57,217,255,.92);
      background: rgba(57,217,255,.08);
      font-weight:1000;
      font-size:11px;
      letter-spacing:.06em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .body{padding:18px}
    h1{margin:0 0 10px; font-size:28px; letter-spacing:-0.03em; line-height:1.15}
    .meta{color:var(--muted2); font-weight:750; font-size:12.5px; line-height:1.5}
    .hr{height:1px; background: rgba(255,255,255,.08); margin:16px 0}
    .p{
      margin:0;
      color: var(--muted);
      font-weight:650;
      font-size:15px;
      line-height:1.75;
      white-space:pre-wrap;
    }
    .actions{
      display:flex; flex-wrap:wrap; gap:10px; margin-top:16px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-weight:950;
      font-size:12px;
    }
    .pill .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 14px rgba(120,255,106,.55);
    }
    .err{
      padding:18px;
      color: var(--muted);
      font-weight:750;
    }
    code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>

<body>
  <header>
    <div class="container">
      <div class="nav">
        <a class="brand" href="index.html">
          <div class="logo" aria-hidden="true"></div>
          <div class="brandTitle">
            <b>NET THUD</b>
            <small>Goal Intelligence</small>
          </div>
        </a>
        <a class="btn" href="index.html">← Back to Home</a>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="panel">
      <div class="panelHead">
        <div class="k">AI News Detail</div>
        <div class="badge" id="badge">Loading…</div>
      </div>
      <div class="body" id="content">
        <div class="err">Loading from <code>news.json</code>…</div>
      </div>
    </div>
  </main>

  <script>
    const NEWS_URL = "news.json";

    const $ = (s, el=document) => el.querySelector(s);

    function safeText(v, fallback="") {
      if (v === null || v === undefined) return fallback;
      return String(v);
    }

    function normalizeItems(raw) {
      if (Array.isArray(raw)) return raw;
      if (raw && Array.isArray(raw.items)) return raw.items;
      if (raw && Array.isArray(raw.news)) return raw.news;
      if (raw && Array.isArray(raw.data)) return raw.data;
      return [];
    }

    function pick(item, keys, fallback="") {
      for (const k of keys) {
        if (item && item[k] !== undefined && item[k] !== null && item[k] !== "") return item[k];
      }
      return fallback;
    }

    function slugify(s) {
      return safeText(s)
        .toLowerCase()
        .trim()
        .replace(/['"]/g, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "");
    }

    function escapeHtml(str) {
      return safeText(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function getWhen(item) {
      const v = pick(item, ["publishedAt", "published_at", "date", "time"], "");
      if (!v) return "";
      const d = new Date(v);
      if (!isNaN(d.getTime())) {
        return d.toLocaleString(undefined, {
          year: "numeric",
          month: "short",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }
      return safeText(v);
    }

    function getTag(item) {
      const tag = pick(item, ["tag", "category", "type"], "AI NEWS").toString().toUpperCase();
      return tag.length > 10 ? "AI NEWS" : tag;
    }

    function matchItem(item, id, idx) {
      const itemId = safeText(pick(item, ["id", "slug"], ""));
      if (itemId && itemId === id) return true;

      const title = safeText(pick(item, ["title", "headline"], ""));
      if (title && slugify(title) === id) return true;

      // allow numeric index
      if (/^\d+$/.test(id)) return Number(id) === idx;

      return false;
    }

    async function load() {
      const params = new URLSearchParams(location.search);
      const id = params.get("id") || "";

      const badge = $("#badge");
      const content = $("#content");

      try {
        const res = await fetch(`${NEWS_URL}?v=${Date.now()}`, { cache: "no-store" });
        if (!res.ok) throw new Error(`news.json HTTP ${res.status}`);
        const raw = await res.json();
        const items = normalizeItems(raw);

        let found = null;
        let foundIndex = -1;

        items.forEach((it, idx) => {
          if (!found && matchItem(it, id, idx)) {
            found = it;
            foundIndex = idx;
          }
        });

        if (!found) {
          badge.textContent = "NOT FOUND";
          content.innerHTML = `
            <div class="err">
              Could not find this item in <code>news.json</code>.<br/>
              Try going back and clicking the item again.
            </div>
          `;
          return;
        }

        const title = safeText(pick(found, ["title", "headline"], "Untitled"));
        const summary = safeText(pick(found, ["summary", "description", "dek"], ""));
        const details =
          safeText(pick(found, ["details", "body", "content", "analysis"], "")) ||
          safeText(pick(found, ["whyItMatters", "why_it_matters"], ""));

        const source = safeText(pick(found, ["source", "publisher"], ""));
        const when = getWhen(found);
        const url = safeText(pick(found, ["url", "link", "sourceUrl", "source_url"], ""));

        const tag = getTag(found);
        badge.textContent = tag;

        const metaBits = [source, when].filter(Boolean).join(" • ");

        content.innerHTML = `
          <h1>${escapeHtml(title)}</h1>
          <div class="meta">${escapeHtml(metaBits || "Net Thud AI News")}</div>
          <div class="hr"></div>
          ${summary ? `<p class="p">${escapeHtml(summary)}</p>` : ""}
          ${summary && details ? `<div class="hr"></div>` : ""}
          ${details ? `<p class="p">${escapeHtml(details)}</p>` : ""}
          <div class="actions">
            ${url ? `<a class="pill" href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer"><span class="dot"></span>Open source</a>` : ""}
            <a class="pill" href="index.html#signals"><span class="dot"></span>Back to signals</a>
          </div>
        `;
      } catch (e) {
        badge.textContent = "ERROR";
        content.innerHTML = `
          <div class="err">
            Failed to load <code>news.json</code>.<br/>
            Make sure it exists at the repo root and GitHub Pages is publishing the latest build.
          </div>
        `;
      }
    }

    load();
  </script>
</body>
</html>