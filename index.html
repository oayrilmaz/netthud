<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Net Thud — Goal Intelligence</title>
  <meta name="description" content="Net Thud tracks decisive football moments. Scores, upcoming + TV, transfers, and AI signals." />

  <style>
    :root{
      --bg:#0b0d10;
      --card:#141821;
      --text:#eaeef3;
      --muted:#9aa3ad;
      --accent:#78ff6a;
      --warn:#ffd166;
      --border:rgba(255,255,255,.08);
      --radius:16px;
      --container:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .container{max-width:var(--container);margin:0 auto;padding:24px}
    header{border-bottom:1px solid var(--border);background:#0f1218;position:sticky;top:0;z-index:10}
    .nav{display:flex;justify-content:space-between;align-items:center;height:64px;gap:12px}
    .brand{font-weight:900;letter-spacing:.14em;font-size:13px}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}
    .right{display:flex;align-items:center;gap:10px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#0f131b;font-size:12px;color:var(--muted)}
    .dot{width:8px;height:8px;border-radius:99px;background:var(--accent);box-shadow:0 0 12px rgba(120,255,106,.35)}
    main{padding:28px 0 40px}
    h1{font-size:42px;margin:0 0 12px}
    p.lead{color:var(--muted);max-width:70ch;line-height:1.7;margin:0 0 26px}
    .grid{display:grid;gap:18px}
    @media(min-width:980px){.grid.two{grid-template-columns:1fr 1fr}}
    section{margin:26px 0}
    .sectionTitle{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .sectionTitle h2{font-size:13px;letter-spacing:.14em;text-transform:uppercase;margin:0}
    .hint{font-size:12px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px}
    .list{display:grid;gap:12px}
    .item{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:14px 14px;border-radius:12px;background:#0f131b;border:1px solid var(--border)}
    .item strong{font-size:15px;display:block}
    .item p{margin:6px 0 0;font-size:13px;color:var(--muted);line-height:1.35}
    .tag{font-size:11px;font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid rgba(120,255,106,.3);color:var(--accent);white-space:nowrap}
    .tag.warn{border-color:rgba(255,209,102,.35);color:var(--warn)}
    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:#0f131b;font-size:13px;color:var(--text)}
    .chip .dot{width:10px;height:10px}
    footer{border-top:1px solid var(--border);padding:20px 0;font-size:12px;color:var(--muted);text-align:center;margin-top:28px}
    .muted{color:var(--muted)}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#0f131b;font-weight:800;font-size:13px}
    .btn.primary{border-color:rgba(120,255,106,.25);box-shadow:0 0 0 1px rgba(120,255,106,.08) inset}
    .btn:active{transform:translateY(1px)}
  </style>
</head>

<body>

<header>
  <div class="container nav">
    <div>
      <div class="brand">NET THUD</div>
      <div class="subtitle">Goal Intelligence</div>
    </div>
    <div class="right">
      <div class="pill" id="soundPill"><span class="dot"></span>Sound: <strong id="soundState">ON</strong></div>
      <a class="pill" href="https://x.com/netthudpro" target="_blank" rel="noopener">@netthudpro</a>
    </div>
  </div>
</header>

<main class="container">

  <section>
    <h1>At the moment it matters.</h1>
    <p class="lead">
      Net Thud focuses on decisive outcomes and match context — with a clean pipeline.
      Scores & schedules are data-driven. Signals come next.
    </p>

    <div class="btnRow">
      <a class="btn primary" href="#finalScores">Final scores</a>
      <a class="btn" href="#upcoming">Upcoming + TV</a>
      <a class="btn" href="#transfers">Transfer desk</a>
      <a class="btn" href="#aiNews">AI news</a>
      <a class="btn" href="#leagues">Leagues</a>
    </div>
  </section>

  <div class="grid two">

    <section id="finalScores">
      <div class="sectionTitle">
        <h2>Final Scores</h2>
        <span class="hint" id="scoresMeta">Loading…</span>
      </div>
      <div class="card">
        <div id="scoresList" class="list"></div>
      </div>
    </section>

    <section id="upcoming">
      <div class="sectionTitle">
        <h2>Upcoming + TV</h2>
        <span class="hint" id="upcomingMeta">Loading…</span>
      </div>
      <div class="card">
        <div id="upcomingList" class="list"></div>
      </div>
    </section>

    <section id="transfers">
      <div class="sectionTitle">
        <h2>Transfer Desk</h2>
        <span class="hint" id="transfersMeta">Loading…</span>
      </div>
      <div class="card">
        <div id="transfersList" class="list"></div>
      </div>
    </section>

    <section id="aiNews">
      <div class="sectionTitle">
        <h2>AI News</h2>
        <span class="hint" id="newsMeta">Loading…</span>
      </div>
      <div class="card">
        <div id="newsList" class="list"></div>
      </div>
    </section>

  </div>

  <section id="leagues">
    <div class="sectionTitle">
      <h2>Leagues</h2>
      <span class="hint" id="leaguesMeta">Loading…</span>
    </div>
    <div class="card">
      <div id="leagueChips" class="chips"></div>
    </div>
  </section>

</main>

<footer>
  © <span id="year"></span> Net Thud • Goal Intelligence
</footer>

<script>
  const PATHS = {
    scores:   "assets/data/scores.json",
    upcoming: "assets/data/upcoming.json",
    transfers:"assets/data/transfers.json",
    news:     "assets/data/ai-news.json",
    leagues:  "assets/data/leagues.json"
  };

  const $ = (id) => document.getElementById(id);

  // ✅ harden against JSON content breaking HTML
  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  function row(title, meta, tagText, tagClass="") {
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `
      <div>
        <strong>${esc(title)}</strong>
        <p>${esc(meta)}</p>
      </div>
      <span class="tag ${esc(tagClass)}">${esc(tagText)}</span>
    `;
    return d;
  }

  function emptyState(container, title, meta) {
    container.innerHTML = "";
    container.appendChild(row(title, meta, "EMPTY", "warn"));
  }

  async function readJson(url) {
    const u = new URL(url, document.baseURI);
    u.searchParams.set("v", Date.now());
    const res = await fetch(u.toString(), { cache:"no-store" });
    if (!res.ok) throw new Error(`Missing: ${url} (HTTP ${res.status})`);
    return res.json();
  }

  // ✅ supports BOTH schemas:
  // - { items: [] } (your current)
  // - { matches: [] } (old)
  async function loadScores() {
    const list = $("scoresList");
    const meta = $("scoresMeta");
    try {
      const data = await readJson(PATHS.scores);

      const items = Array.isArray(data.items) ? data.items : [];
      const matches = Array.isArray(data.matches) ? data.matches : [];

      const count = items.length || matches.length || 0;
      meta.textContent = `${count} • updated ${data.generatedAt || data.updated || "—"}`;

      list.innerHTML = "";
      if (!count) return emptyState(list, "No final scores yet", "Matches will appear here once completed.");

      // If new schema exists, render it
      if (items.length) {
        items.forEach(m => {
          list.appendChild(
            row(
              `${m.home || ""} ${m.score || ""} ${m.away || ""}`.trim(),
              `${m.league || ""}${m.when ? " • " + m.when : ""}${m.status ? " • " + m.status : ""}`,
              m.status || "FT"
            )
          );
        });
        return;
      }

      // Else render old matches schema
      matches.forEach(m => {
        list.appendChild(
          row(
            `${m.home} ${m.homeScore}–${m.awayScore} ${m.away}`,
            `${m.league} • ${m.date}`,
            "FT"
          )
        );
      });
    } catch (e) {
      meta.textContent = "error";
      list.innerHTML = "";
      list.appendChild(row("Scores not loading", e.message, "ERR", "warn"));
      console.error(e);
    }
  }

  async function loadUpcoming() {
    const list = $("upcomingList");
    const meta = $("upcomingMeta");
    try {
      const data = await readJson(PATHS.upcoming);
      const items = data.items || [];
      meta.textContent = `${items.length} • updated ${data.generatedAt || data.updated || "—"}`;

      list.innerHTML = "";
      if (!items.length) return emptyState(list, "No upcoming games yet", "Populate assets/data/upcoming.json");

      items.forEach(g => {
        const channels = (g.tv || []).join(", ");
        list.appendChild(
          row(
            `${g.home} vs ${g.away}`,
            `${g.league} • ${g.kickoffLocal || g.kickoffUTC || ""}${channels ? " • " + channels : ""}`,
            "UP"
          )
        );
      });
    } catch (e) {
      meta.textContent = "error";
      list.innerHTML = "";
      list.appendChild(row("Upcoming not loading", e.message, "ERR", "warn"));
      console.error(e);
    }
  }

  async function loadTransfers() {
    const list = $("transfersList");
    const meta = $("transfersMeta");
    try {
      const data = await readJson(PATHS.transfers);
      const items = data.items || [];
      meta.textContent = `${items.length} • updated ${data.generatedAt || data.updated || "—"}`;

      list.innerHTML = "";
      if (!items.length) return emptyState(list, "No transfer items yet", "Populate assets/data/transfers.json");

      items.forEach(t => {
        list.appendChild(
          row(
            t.title || "Transfer update",
            `${t.source || "source"} • ${t.publishedAt || t.date || ""}`,
            "NEW"
          )
        );
      });
    } catch (e) {
      meta.textContent = "error";
      list.innerHTML = "";
      list.appendChild(row("Transfers not loading", e.message, "ERR", "warn"));
      console.error(e);
    }
  }

  async function loadNews() {
    const list = $("newsList");
    const meta = $("newsMeta");
    try {
      const data = await readJson(PATHS.news);
      const items = data.items || [];
      meta.textContent = `${items.length} • updated ${data.generatedAt || data.updated || "—"}`;

      list.innerHTML = "";
      if (!items.length) return emptyState(list, "No news items yet", "Populate assets/data/ai-news.json");

      items.slice(0, 10).forEach(n => {
        const el = document.createElement("a");
        el.href = n.url || "#";
        el.target = "_blank";
        el.rel = "noopener";
        el.className = "item";
        el.innerHTML = `
          <div>
            <strong>${esc(n.title || "News item")}</strong>
            <p>${esc(n.source || "")}${n.publishedAt ? " • " + esc(n.publishedAt.slice(0,10)) : ""}${n.summary ? " • " + esc(n.summary) : ""}</p>
          </div>
          <span class="tag">OPEN</span>
        `;
        list.appendChild(el);
      });
    } catch (e) {
      meta.textContent = "error";
      list.innerHTML = "";
      list.appendChild(row("AI News not loading", e.message, "ERR", "warn"));
      console.error(e);
    }
  }

  async function loadLeagues() {
    const container = $("leagueChips");
    const meta = $("leaguesMeta");
    try {
      const data = await readJson(PATHS.leagues);

      const leagues = Array.isArray(data) ? data
                    : Array.isArray(data.items) ? data.items
                    : Array.isArray(data.leagues) ? data.leagues
                    : [];

      meta.textContent = `${leagues.length} • updated ${data.updated || data.generatedAt || "—"}`;

      container.innerHTML = "";
      if (!leagues.length) {
        const empty = document.createElement("div");
        empty.className = "item";
        empty.innerHTML = `
          <div>
            <strong>No leagues yet</strong>
            <p>assets/data/leagues.json loaded, but items[] is empty.</p>
          </div>
          <span class="tag warn">EMPTY</span>
        `;
        container.appendChild(empty);
        return;
      }

      leagues.forEach(l => {
        const el = document.createElement("div");
        el.className = "chip";

        const name = (l && typeof l === "object") ? (l.name || l.key || "League") : String(l);
        const emoji = (l && typeof l === "object") ? (l.emoji || "") : "";
        const country = (l && typeof l === "object") ? (l.country || "") : "";

        el.innerHTML = `<span class="dot"></span>${esc(emoji ? emoji + " " : "")}${esc(name)}${esc(country ? " • " + country : "")}`;
        container.appendChild(el);
      });
    } catch (e) {
      meta.textContent = "error";
      container.innerHTML = "";
      container.appendChild(row("Leagues not loading", e.message, "ERR", "warn"));
      console.error(e);
    }
  }

  // Sound toggle
  const SOUND_KEY = "netthud_sound";
  function setSoundUI(on){ $("soundState").textContent = on ? "ON" : "OFF"; }
  function getSound(){ return localStorage.getItem(SOUND_KEY) !== "0"; }
  function setSound(on){ localStorage.setItem(SOUND_KEY, on ? "1" : "0"); setSoundUI(on); }
  function beep(){
    if (!getSound()) return;
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type="sine"; o.frequency.value=440; g.gain.value=0.02;
      o.connect(g); g.connect(ctx.destination);
      o.start(); setTimeout(()=>{o.stop(); ctx.close();}, 80);
    }catch{}
  }

  document.getElementById("year").textContent = new Date().getFullYear();

  document.addEventListener("DOMContentLoaded", async () => {
    setSoundUI(getSound());
    document.getElementById("soundPill").addEventListener("click", ()=>{
      const on = !getSound();
      setSound(on);
      beep();
    });

    await loadScores();
    await loadUpcoming();
    await loadTransfers();
    await loadNews();
    await loadLeagues();
  });
</script>

</body>
</html>